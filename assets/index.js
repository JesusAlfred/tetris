(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const f of n.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function c(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(t){if(t.ep)return;t.ep=!0;const n=c(t);fetch(t.href,n)}})();let b=5;const i=20,u=14,M=30,d=[{x:null,y:null,shape:[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]},{x:null,y:null,shape:[[0,2,0,0],[0,2,0,0],[0,2,0,0],[0,2,0,0]]},{x:null,y:null,shape:[[0,3,0,0],[3,3,3,0],[0,0,0,0],[0,0,0,0]]},{x:null,y:null,shape:[[4,4,0,0],[0,4,4,0],[0,0,0,0],[0,0,0,0]]},{x:null,y:null,shape:[[0,5,5,0],[5,5,0,0],[0,0,0,0],[0,0,0,0]]}];let s=null,a=[];L();const g=document.querySelector("#game"),y=g.getContext("2d"),p=document.querySelector("#nextShape"),E=p.getContext("2d");g.width=i*u;g.height=i*M;p.width=i*4;p.height=i*4;y.scale(i,i);E.scale(i,i);let l=null;function h(){l=P();let e=!0;l.x=Math.floor(u/2-l.shape[0].length/2),l.y=0,l.shape.forEach((r,c)=>{r.forEach((o,t)=>{o!==0&&(a[c+l.y][t+l.x]!==0?e=!1:a[c+l.y][t+l.x]=o)})}),e||(L(),h(),b=5)}function A(){a.forEach((e,r)=>{let c=!0;if(e.forEach((o,t)=>{o===0&&(c=!1)}),c)for(let o=r;o>0;o--)for(let t=0;t<u;t++)a[o][t]=a[o-1][t]})}h();let w=0;C();function C(e){e-w>=1e3/b&&(w=e,O(l)?v(l):(A(),h(),b+=.2)),I(),window.requestAnimationFrame(C)}document.addEventListener("keydown",e=>{switch(e.key){case"ArrowDown":O(l)?v(l):(A(),h());break;case"ArrowUp":H(l)&&(m(l),l.shape=R(l.shape),x(l));break;case"ArrowLeft":k(l,-1)&&S(l,-1);break;case"ArrowRight":k(l,1)&&S(l,1);break;case"Enter":break;case" ":break;case"Escape":break;default:return}});function H(e){let r=R(e.shape),c=!0;return r.forEach((o,t)=>{o.forEach((n,f)=>{n!==0&&(a[t+e.y]?a[t+e.y][f+e.x]!==n&&a[t+e.y][f+e.x]!==0&&(c=!1):c=!1)})}),c}function S(e,r){m(e),e.x+=r,x(e)}function k(e,r){let c=!0;return e.shape.forEach((o,t)=>{o.forEach((n,f)=>{n!==0&&(a[t+e.y]?a[t+e.y][f+e.x+r]!==n&&a[t+e.y][f+e.x+r]!==0&&(c=!1):c=!1)})}),c}function O(e){let r=!0;return e.shape.forEach((c,o)=>{c.forEach((t,n)=>{t!==0&&(a[o+e.y+1]?a[o+e.y+1][n+e.x]!==t&&a[o+e.y+1][n+e.x]!==0&&(r=!1):r=!1)})}),r||e.shape.forEach((c,o)=>{c.forEach((t,n)=>{t!==0&&(a[o+e.y][n+e.x]=t+.1)})}),r}function m(e){e.shape.forEach((r,c)=>{r.forEach((o,t)=>{o!==0&&(a[c+e.y][t+e.x]=0)})})}function v(e){m(e),e.y++,x(e)}function x(e){e.shape.forEach((r,c)=>{r.forEach((o,t)=>{o!==0&&(a[c+e.y][t+e.x]=o)})})}function I(){a.forEach((e,r)=>{e.forEach((c,o)=>{let t=null;switch(Math.floor(c)){case 0:t="rgb(60, 60, 60)";break;case 1:t="rgb(255, 173, 96)";break;case 2:t="rgb(255, 238, 173)";break;case 3:t="rgb(150, 206, 180)";break;case 4:t="rgb(160, 35, 52)";break;case 5:t="rgb(200,0,200)";break}y.fillStyle=t,y.fillRect(o,r,1,1)})})}function P(){let e=Math.floor(Math.random()*5),r=null;return s===null?(s=structuredClone(d[e]),e=Math.floor(Math.random()*5),r=structuredClone(d[e])):(r=s,s=structuredClone(d[e])),q(s.shape),r}function q(e){e.forEach((r,c)=>{r.forEach((o,t)=>{let n=null;switch(o){case 0:n="rgb(60, 60, 60)";break;case 1:n="rgb(255, 173, 96)";break;case 2:n="rgb(255, 238, 173)";break;case 3:n="rgb(150, 206, 180)";break;case 4:n="rgb(160, 35, 52)";break;case 5:n="rgb(200,0,200)";break}E.fillStyle=n,E.fillRect(t,c,1,1)})})}function L(){a=[];for(let e=0;e<M;e++){a.push([]);for(let r=0;r<u;r++)a[e].push(0)}}function R(e){const r=e.length,c=e[0].length,o=[];for(let t=0;t<c;t++){o.push([]);for(let n=0;n<r;n++)o[t].push([])}return e.forEach((t,n)=>{t.forEach((f,T)=>{o[c-1-T][n]=f})}),o}
